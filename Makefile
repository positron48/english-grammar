# Makefile Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼ english-grammar

.PHONY: help final final-all validate-all validate-uniqueness clean admin run test dev update-admin-index update-test-index

# ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð²ÑÐµ Ð³Ð»Ð°Ð²Ñ‹ (Ñ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑÐ°Ð¼Ð¸ Ð¸Ð»Ð¸ Ð±ÐµÐ·)
# Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ chapter_id Ð¸Ð· Ð¸Ð¼ÐµÐ½Ð¸ Ð¿Ð°Ð¿ÐºÐ¸ (ÑƒÐ±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ñ€ÐµÑ„Ð¸ÐºÑ Ð²Ð¸Ð´Ð° 001.)
CHAPTERS := $(shell find chapters -mindepth 1 -maxdepth 1 -type d -not -name '.*' | sed 's|chapters/||' | sed 's|^[0-9][0-9][0-9]\.||' | sort -u)

help:
	@echo "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹:"
	@echo "  make final              - ÐŸÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ final.json Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ñ… Ð³Ð»Ð°Ð²"
	@echo "  make final-all          - ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ final.json Ð´Ð»Ñ Ð²ÑÐµÑ… Ð³Ð»Ð°Ð²"
	@echo "  make validate-all        - Ð’Ð°Ð»Ð¸Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð³Ð»Ð°Ð²Ñ‹"
	@echo "  make validate-uniqueness - ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ Ð²ÑÐµÐ¼Ñƒ ÐºÑƒÑ€ÑÑƒ"
	@echo "  make admin               - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð³Ð»Ð°Ð²"
	@echo "  make run                 - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ð¾Ð²ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ ÐºÑƒÑ€ÑÐ°"
	@echo "  make test                - ÐÐ»Ð¸Ð°Ñ Ð´Ð»Ñ make run (Ñ‚ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°)"
	@echo "  make dev                 - Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¾Ð±Ð° ÑÐµÑ€Ð²ÐµÑ€Ð° (admin + test) Ñ Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼"
	@echo "  make clean               - Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹"
	@echo ""
	@echo "ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ Ð³Ð»Ð°Ð²: $(words $(CHAPTERS))"
	@echo "$(foreach ch,$(CHAPTERS),  - $(ch)$(newline))"

# ÐŸÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ final.json (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ðµ Ð³Ð»Ð°Ð²Ñ‹)
final:
	@bash -c '\
		echo "ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° final.json Ð´Ð»Ñ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð½Ñ‹Ñ… Ð³Ð»Ð°Ð²..."; \
		UPDATED=0; SKIPPED=0; \
		source scripts/chapter-utils.sh; \
		for chapter in $(CHAPTERS); do \
			CHAPTER_DIR=$$(get_chapter_dir "$$chapter" "$$(pwd)/chapters"); \
			if [ $$? -ne 0 ] || [ -z "$$CHAPTER_DIR" ]; then \
				echo "  âš ï¸  ÐŸÐ°Ð¿ÐºÐ° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°: $$chapter"; \
				continue; \
			fi; \
			FINAL_FILE="$$CHAPTER_DIR/05-final.json"; \
			OUTLINE_FILE="$$CHAPTER_DIR/01-outline.json"; \
			QUESTIONS_FILE="$$CHAPTER_DIR/03-questions.json"; \
			THEORY_BLOCKS_DIR="$$CHAPTER_DIR/02-theory-blocks"; \
			NEEDS_REBUILD=false; \
			if [ ! -f "$$FINAL_FILE" ]; then \
				NEEDS_REBUILD=true; \
			elif [ -f "$$OUTLINE_FILE" ] && [ "$$OUTLINE_FILE" -nt "$$FINAL_FILE" ]; then \
				NEEDS_REBUILD=true; \
			elif [ -f "$$QUESTIONS_FILE" ] && [ "$$QUESTIONS_FILE" -nt "$$FINAL_FILE" ]; then \
				NEEDS_REBUILD=true; \
			elif [ -d "$$THEORY_BLOCKS_DIR" ]; then \
				for block_file in $$THEORY_BLOCKS_DIR/*.json; do \
					if [ -f "$$block_file" ] && [ "$$block_file" -nt "$$FINAL_FILE" ]; then \
						NEEDS_REBUILD=true; \
						break; \
					fi; \
				done; \
			fi; \
			if [ "$$NEEDS_REBUILD" = true ]; then \
				echo "  ðŸ”¨ ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ°: $$chapter"; \
				if bash scripts/assemble-chapter.sh $$chapter > /dev/null 2>&1; then \
					UPDATED=$$((UPDATED + 1)); \
				else \
					echo "    âœ— ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ±Ð¾Ñ€ÐºÐµ $$chapter"; \
				fi; \
			else \
				SKIPPED=$$((SKIPPED + 1)); \
			fi; \
		done; \
		echo ""; \
		if [ $$UPDATED -gt 0 ] || [ $$SKIPPED -gt 0 ]; then \
			echo "âœ“ ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°: Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ $$UPDATED Ð³Ð»Ð°Ð², Ð¿Ñ€Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ð¾ $$SKIPPED Ð³Ð»Ð°Ð²"; \
		fi'

# ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð¿ÐµÑ€ÐµÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ Ð²ÑÐµ final.json
final-all:
	@echo "ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿ÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° final.json Ð´Ð»Ñ Ð²ÑÐµÑ… Ð³Ð»Ð°Ð²..."
	@UPDATED=0; FAILED=0; \
	for chapter in $(CHAPTERS); do \
		echo "  ðŸ”¨ ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ°: $$chapter"; \
		if bash scripts/assemble-chapter.sh $$chapter > /dev/null 2>&1; then \
			UPDATED=$$((UPDATED + 1)); \
		else \
			echo "    âœ— ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ±Ð¾Ñ€ÐºÐµ $$chapter"; \
			FAILED=$$((FAILED + 1)); \
		fi; \
	done; \
	echo ""; \
	echo "âœ“ ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°: Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ $$UPDATED Ð³Ð»Ð°Ð²"; \
	if [ $$FAILED -gt 0 ]; then \
		echo "  âš ï¸  ÐžÑˆÐ¸Ð±Ð¾Ðº: $$FAILED Ð³Ð»Ð°Ð²"; \
	fi

# Ð’Ð°Ð»Ð¸Ð´Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð³Ð»Ð°Ð²Ñ‹
validate-all:
	@for chapter in $(CHAPTERS); do \
		bash scripts/validate-chapter.sh $$chapter; \
	done
	@echo ""
	@echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ Ð²ÑÐµÐ¼Ñƒ ÐºÑƒÑ€ÑÑƒ..."
	@bash scripts/validate-course-uniqueness.sh || true

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ Ð²ÑÐµÐ¼Ñƒ ÐºÑƒÑ€ÑÑƒ
validate-uniqueness:
	@bash scripts/validate-course-uniqueness.sh

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
clean:
	@echo "ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
	@find . -type f -name "*.tmp" -delete
	@find . -type f -name "*~" -delete
	@echo "âœ“ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸
update-admin-index:
	@if [ ! -f admin/data/chapters-index.json ]; then \
		echo "Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸..."; \
		node admin/generate-index.js || (echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸." && exit 1); \
		echo "âœ“ Ð˜Ð½Ð´ÐµÐºÑ ÑÐ¾Ð·Ð´Ð°Ð½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"; \
	elif [ -n "$$(find chapters -mindepth 1 -maxdepth 1 -type d -not -name '.*' -newer admin/data/chapters-index.json 2>/dev/null | head -1)" ] || \
		[ -n "$$(find chapters -mindepth 1 -maxdepth 2 -type f \( -name "05-final.json" -o -name "01-outline.json" \) -newer admin/data/chapters-index.json 2>/dev/null | head -1)" ]; then \
		echo "ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð³Ð»Ð°Ð²Ð°Ñ…, Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ° Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸..."; \
		node admin/generate-index.js || (echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸." && exit 1); \
		echo "âœ“ Ð˜Ð½Ð´ÐµÐºÑ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"; \
	else \
		echo "âœ“ Ð˜Ð½Ð´ÐµÐºÑ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÐµÐ½"; \
	fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
update-test-index:
	@if [ ! -f test/data/chapters-index.json ]; then \
		echo "Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."; \
		node test/scripts/generate-chapters-index.js || (echo "âš ï¸  ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ: Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð˜Ð½Ð´ÐµÐºÑ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½." && echo "   Ð”Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js."); \
	elif [ -n "$$(find chapters -mindepth 1 -maxdepth 1 -type d -not -name '.*' -newer test/data/chapters-index.json 2>/dev/null | head -1)" ] || \
		[ -n "$$(find chapters -mindepth 1 -maxdepth 2 -type f -name "05-final.json" -newer test/data/chapters-index.json 2>/dev/null | head -1)" ]; then \
		echo "ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð³Ð»Ð°Ð²Ð°Ñ…, Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."; \
		node test/scripts/generate-chapters-index.js || (echo "âš ï¸  ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ðµ: Node.js Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð˜Ð½Ð´ÐµÐºÑ Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½." && echo "   Ð”Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸Ð½Ð´ÐµÐºÑÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js."); \
	else \
		echo "âœ“ Ð˜Ð½Ð´ÐµÐºÑ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð°ÐºÑ‚ÑƒÐ°Ð»ÐµÐ½"; \
	fi

# Ð—Ð°Ð¿ÑƒÑÐº Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸
admin:
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ðŸ“š ÐÐ”ÐœÐ˜Ð-ÐŸÐÐÐ•Ð›Ð¬: Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ ÐºÑƒÑ€ÑÐ¾Ð² Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ‚Ð¸ÐºÐ¸"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "Ð§Ñ‚Ð¾ ÑÑ‚Ð¾:"
	@echo "  Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð²ÑÐµÑ… Ð³Ð»Ð°Ð² ÐºÑƒÑ€ÑÐ°, Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ñ,"
	@echo "  ÐºÐ¾Ð¼Ð¿Ð¾Ð½Ð¾Ð²ÐºÐ¸, ÑÐ¿Ð¸ÑÐºÐ° Ð²ÑÐµÑ… Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸."
	@echo ""
	@echo "Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸:"
	@echo "  â€¢ ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ð³Ð»Ð°Ð² Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸ÐµÐ¹ Ð¸ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð¼"
	@echo "  â€¢ Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð³Ð»Ð°Ð²Ñ‹ (Ñ‚ÐµÐ¾Ñ€Ð¸Ñ, Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹, ÐºÐ²Ð¸Ð·Ñ‹, Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ)"
	@echo "  â€¢ Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ Ð³Ð»Ð°Ð²Ð°Ð¼ Ð¸ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼"
	@echo "  â€¢ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð² Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸"
	@echo ""
	@$(MAKE) -s update-admin-index
	@if [ ! -f admin/data/chapters-index.json ]; then \
		echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ð˜Ð½Ð´ÐµÐºÑ Ð½Ðµ Ð±Ñ‹Ð» ÑÐ¾Ð·Ð´Ð°Ð½. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¿Ñ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°."; \
		exit 1; \
	fi
	@echo ""
	@echo "Ð—Ð°Ð¿ÑƒÑÐº Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€Ð°..."
	@if command -v php >/dev/null 2>&1; then \
		echo "âœ“ PHP Ð½Ð°Ð¹Ð´ÐµÐ½, Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ PHP ÑÐµÑ€Ð²ÐµÑ€ (Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ API)..."; \
	else \
		echo "âš ï¸  Ð’ÐÐ˜ÐœÐÐÐ˜Ð•: PHP Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"; \
		echo "   Ð”Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼ PHP ÑÐµÑ€Ð²ÐµÑ€."; \
		echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ PHP: sudo apt install php"; \
		echo ""; \
		echo "   Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Python ÑÐµÑ€Ð²ÐµÑ€ (Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ - ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚)..."; \
	fi
	@echo ""
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!"
	@echo ""
	@echo "ðŸŒ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ:"
	@echo "   http://localhost:8000/admin/"
	@echo ""
	@echo "ðŸ“– Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@if command -v inotifywait >/dev/null 2>&1; then \
		echo "ðŸ” Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð³Ð»Ð°Ð² (Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²)..."; \
		bash scripts/watch-chapters.sh admin & \
		WATCH_PID=$$!; \
		trap "kill $$WATCH_PID 2>/dev/null; exit" INT TERM; \
		if command -v php >/dev/null 2>&1; then \
			php -S localhost:8000 -t . 2>/dev/null || \
			(kill $$WATCH_PID 2>/dev/null; echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° PHP ÑÐµÑ€Ð²ÐµÑ€Ð°" && exit 1); \
		else \
			python3 -m http.server 8000 2>/dev/null || \
			(kill $$WATCH_PID 2>/dev/null; echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ Python3 Ð¸Ð»Ð¸ PHP Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°." && \
			 echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ PHP: sudo apt install php" && \
			 echo "   Ð˜Ð»Ð¸ Python3: sudo apt install python3" && exit 1); \
		fi; \
		kill $$WATCH_PID 2>/dev/null; \
	else \
		echo "âš ï¸  inotifywait Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ - Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð² Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾"; \
		echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: sudo apt install inotify-tools"; \
		echo ""; \
		if command -v php >/dev/null 2>&1; then \
			php -S localhost:8000 -t . 2>/dev/null || \
			(echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° PHP ÑÐµÑ€Ð²ÐµÑ€Ð°" && exit 1); \
		else \
			python3 -m http.server 8000 2>/dev/null || \
			(echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ Python3 Ð¸Ð»Ð¸ PHP Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°." && \
			 echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ PHP: sudo apt install php" && \
			 echo "   Ð˜Ð»Ð¸ Python3: sudo apt install python3" && exit 1); \
		fi; \
	fi

# Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ
run:
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ðŸ“š Ð¢Ð•Ð¡Ð¢ÐžÐ’ÐÐ¯ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ: Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ ÐºÑƒÑ€Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð°Ð½Ð³Ð»Ð¸Ð¹ÑÐºÐ¾Ð¹ Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ‚Ð¸ÐºÐ¸"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@$(MAKE) -s update-test-index
	@echo ""
	@echo "Ð§Ñ‚Ð¾ ÑÑ‚Ð¾:"
	@echo "  Ð“Ð¾Ñ‚Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ ÐºÑƒÑ€ÑÐ° Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ‚Ð¸ÐºÐ¸ Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼Ð¸, Ñ‚ÐµÐ¾Ñ€Ð¸ÐµÐ¹,"
	@echo "  inline-ÐºÐ²Ð¸Ð·Ð°Ð¼Ð¸ Ð² Ñ‚ÐµÐ»Ðµ Ð³Ð»Ð°Ð² Ð¸ Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¼ Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼."
	@echo ""
	@echo "Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸:"
	@echo "  â€¢ ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ð¼ Ð¸ Ð³Ð»Ð°Ð²Ð°Ð¼ ÐºÑƒÑ€ÑÐ°"
	@echo "  â€¢ Ð˜Ð·ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐ¾Ñ€Ð¸Ð¸ Ñ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ð°Ð¼Ð¸ Ð¸ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼Ð¸ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸"
	@echo "  â€¢ Inline-ÐºÐ²Ð¸Ð·Ñ‹ Ð´Ð»Ñ Ð·Ð°ÐºÑ€ÐµÐ¿Ð»ÐµÐ½Ð¸Ñ Ð¼Ð°Ñ‚ÐµÑ€Ð¸Ð°Ð»Ð° Ð¿Ð¾ÑÐ»Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð±Ð»Ð¾ÐºÐ°"
	@echo "  â€¢ Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹ Ñ Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ð¸ Ð¾Ñ‚Ð±Ð¾Ñ€Ð°"
	@echo "  â€¢ Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¾Ð² Ñ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸"
	@echo ""
	@echo "Ð—Ð°Ð¿ÑƒÑÐº Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€Ð°..."
	@echo ""
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!"
	@echo ""
	@echo "ðŸŒ ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð² Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ðµ:"
	@echo "   http://localhost:8001/test/"
	@echo ""
	@echo "ðŸ“– Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÑƒÑ€ÑÐ°:"
	@echo "   - Ð“Ð»Ð°Ð²Ð½Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ñ Ñ€Ð°Ð·Ð´ÐµÐ»Ð°Ð¼Ð¸ Ð¸ Ð³Ð»Ð°Ð²Ð°Ð¼Ð¸: http://localhost:8001/test/"
	@echo "   - Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð³Ð»Ð°Ð²Ñ‹ Ñ Ñ‚ÐµÐ¾Ñ€Ð¸ÐµÐ¹ Ð¸ ÐºÐ²Ð¸Ð·Ð°Ð¼Ð¸: http://localhost:8001/test/chapter.html"
	@echo "   - Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ñ„Ð¸Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð°: http://localhost:8001/test/test.html"
	@echo ""
	@echo "ðŸ’¡ Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@if command -v inotifywait >/dev/null 2>&1; then \
		echo "ðŸ” Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð³Ð»Ð°Ð² (Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²)..."; \
		bash scripts/watch-chapters.sh test & \
		WATCH_PID=$$!; \
		trap "kill $$WATCH_PID 2>/dev/null; exit" INT TERM; \
		python3 -m http.server 8001 2>/dev/null || \
		 (php -S localhost:8001 2>/dev/null) || \
		 (kill $$WATCH_PID 2>/dev/null; echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ Python3 Ð¸Ð»Ð¸ PHP Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°." && \
		  echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Python3: sudo apt install python3" && \
		  echo "   Ð˜Ð»Ð¸ PHP: sudo apt install php" && exit 1); \
		kill $$WATCH_PID 2>/dev/null; \
	else \
		echo "âš ï¸  inotifywait Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ - Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð² Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾"; \
		echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: sudo apt install inotify-tools"; \
		echo ""; \
		python3 -m http.server 8001 2>/dev/null || \
		 (php -S localhost:8001 2>/dev/null) || \
		 (echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÐÐµ Ð½Ð°Ð¹Ð´ÐµÐ½ Python3 Ð¸Ð»Ð¸ PHP Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°." && \
		  echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Python3: sudo apt install python3" && \
		  echo "   Ð˜Ð»Ð¸ PHP: sudo apt install php" && exit 1); \
	fi

# ÐÐ»Ð¸Ð°Ñ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ run
test: run

# Ð—Ð°Ð¿ÑƒÑÐº Ð¾Ð±Ð¾Ð¸Ñ… ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð² Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ñ Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼
dev:
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo "ðŸš€ Ð—ÐÐŸÐ£Ð¡Ðš Ð ÐÐ—Ð ÐÐ‘ÐžÐ¢ÐšÐ˜: ÐÐ´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ + Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°"
	@echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
	@echo ""
	@echo "ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²..."
	@$(MAKE) -s update-admin-index >/dev/null 2>&1 || true
	@$(MAKE) -s update-test-index >/dev/null 2>&1 || true
	@echo "âœ“ Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
	@echo ""
	@echo "Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð² Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°..."
	@echo ""
	@bash -c '\
		cleanup() { \
			echo ""; \
			echo "ðŸ›‘ ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð²..."; \
			trap "" INT TERM; \
			if [ -n "$$PIDS" ]; then \
				for pid in $$PIDS; do \
					kill $$pid 2>/dev/null || true; \
				done; \
				sleep 0.1; \
				for pid in $$PIDS; do \
					kill -9 $$pid 2>/dev/null || true; \
				done; \
			fi; \
			exit 0; \
		}; \
		trap cleanup INT TERM; \
		PIDS=""; \
		if command -v inotifywait >/dev/null 2>&1; then \
			echo "ðŸ” Ð—Ð°Ð¿ÑƒÑÐº Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð³Ð»Ð°Ð² (Ñ Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð² Ð¸ final.json)..."; \
			bash scripts/watch-chapters.sh both --rebuild-final & \
			PIDS="$$PIDS $$!"; \
		fi; \
		echo "ðŸ“š Ð—Ð°Ð¿ÑƒÑÐº Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸ (http://localhost:8000/admin/)..."; \
		if command -v php >/dev/null 2>&1; then \
			php -S localhost:8000 -t . >/dev/null 2>&1 & \
			PIDS="$$PIDS $$!"; \
		else \
			python3 -m http.server 8000 >/dev/null 2>&1 & \
			PIDS="$$PIDS $$!"; \
		fi; \
		echo "ðŸ“š Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ (http://localhost:8001/test/)..."; \
		if command -v python3 >/dev/null 2>&1; then \
			python3 -m http.server 8001 >/dev/null 2>&1 & \
			PIDS="$$PIDS $$!"; \
		elif command -v php >/dev/null 2>&1; then \
			php -S localhost:8001 >/dev/null 2>&1 & \
			PIDS="$$PIDS $$!"; \
		fi; \
		echo ""; \
		echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"; \
		echo "âœ… Ð¡ÐµÑ€Ð²ÐµÑ€Ñ‹ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹!"; \
		echo ""; \
		echo "ðŸŒ ÐÐ´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ:  http://localhost:8000/admin/"; \
		echo "ðŸŒ Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°: http://localhost:8001/test/"; \
		echo ""; \
		if command -v inotifywait >/dev/null 2>&1; then \
			echo "ðŸ” ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½ - Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸"; \
		else \
			echo "âš ï¸  inotifywait Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ - Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð² Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾"; \
			echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: sudo apt install inotify-tools"; \
		fi; \
		echo ""; \
		echo "ðŸ“– Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C"; \
		echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"; \
		echo ""; \
		for pid in $$PIDS; do \
			wait $$pid 2>/dev/null || true; \
		done'
